<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- <link href="fonts.googleapis.com" rel="stylesheet"> -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100..900&display=swap" rel="stylesheet">
    <title>Space Weather Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-adapter-moment/1.0.1/chartjs-adapter-moment.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* max-width: 1500px; */
        }
        
        body {
            /* font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; */
            font-family: 'Roboto Slab', sans-serif;
            background: linear-gradient(180deg, #513624 100%, #513624 100%);
            padding: 0px;
            max-height: 100vh;
        }

        .menu {
            font-family: 'Libre Baskerville', 'Roboto Slab', 'Roboto', sans-serif;
            color: #a5a5a5;
            text-align: center;
            background: #1e1e1e;
            margin-bottom: 30px;
            height: 130px;
           
            /* background-color: black */
        }

        .header {
            font-family: 'Libre Baskerville', 'Roboto Slab', 'Roboto', sans-serif;
            text-align: center;
            color: #098ca4;
            width: 100%;
            margin-bottom: 60px;
            margin-left: 0px;
            margin-right: 0px;
            margin-top: 0px;
            /* background-color: black */
        }

        .header h1 {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 2.0em;
            margin-bottom: 10px;
            /* text-shadow: 2px 2px 4px rgba(0,0,0,0.3); */
            /* font-color: red; */
        }
        
        .header p {
            font-family: 'Libre Baskerville', 'Roboto Slab', 'Roboto', sans-serif;
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .dashboardZero {
            display: block;
            grid-template-columns: repeat(1, 1fr);
            gap: 20px;
            max-width: 1250px;
            margin: 0 auto;
            background-color: white;
        }
        .dashboardOne {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 20px;
            max-width: 400px;
            margin: 0 auto;
        }

        .dashboardTwo {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 20px;
            max-width: 1200px;
            /* max-height: 100px; */
            margin: 0 auto;
        }

        .dashboardThree {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            max-width: 1200px;
            /* max-height: 100px; */
            margin: 0 auto;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        button:hover {
            opacity: 0.9;
        }
        
        button.active {
            background: #2563eb;
            color: white;
        }
        
        button:not(.active) {
            background: #e5e7eb;
            color: #374151;
        }

        #refreshBtn {
            background: #2563eb;
            color: white;
            padding: 10px 15px;
        }
        
        #refreshBtn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .card {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            font-family: 'Libre Baskerville', Roboto Slab, Roboto, sans-serif;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.3);
        }
        
        .card h2 {
            color: #3C3939;
            margin-bottom: 15px;
            font-size: 1.4em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .card canvas {
            max-height: 400px;
        }
        
        .card img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            display: block;
        }
        
        .card p {
            color: #666;
            margin-top: 10px;
            line-height: 1.6;
            font-size: 0.95em;
        }
        
        .card a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        
        .card a:hover {
            text-decoration: underline;
        }
        
        .refresh-info {
            text-align: center;
            color: white;
            margin-top: 30px;
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .last-updated {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 6px;
            display: inline-block;
            margin-top: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .status {
            font-size: 0.85em;
            color: #888;
            margin-top: 5px;
        }
        
        .IMGcontainer {
            width: 1200px;
            height: 150px;
            border: 1px solid black;
            /* background-image: url('your-image.jpg'); Replace with your image path */
        }
        .center {
        display: block;
        margin-left: auto;
        margin-right: auto;
        max-width: 600px;
        margin-top: 10px;
        margin-bottom: 20px;
        background: rgba(255,255,255,1);
        padding: 5px;
        border-radius: 15px;
        /* width: 50%; */
    }

        .custom-link {
            color: #a5a5a5;              /* normal state */
            text-decoration: none; 
        }
        
        .custom-link:hover {
            color: green;             /* when mouse hovers over it */
            text-decoration: none; 
        }
        
        .custom-link:active {
            color: red;               /* when being clicked */
            text-decoration: none; 
        }
        
        .custom-link:visited {
            color: gray;              /* after it's been visited */
            text-decoration: none; 
        }
        #mySpecialLink {
            color: blue;
            text-decoration: none; 
        }
        
        #mySpecialLink:visited {
            color: #a5a5a5;
            text-decoration: none; 
        }

        /* @media (max-width: 1500px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            .dashboardOne {
                grid-template-columns: 1fr;
            }
        } */

        .nav-container {
            max-width: 2500px;
            margin: 0 auto;
            background: #1e1e1e;
            color: #a5a5a5;
            padding-top: 0px;
            padding-bottom: 0px;
            padding-left: 450px;
            padding-right: 0px;
        }

        .nav-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            list-style: none;
            gap: 0;
            padding: 15px 0;
            /* border-bottom: 1px solid #3d3d3d; */
        }

        .nav-row:last-child {
            border-bottom: none;
        }

        .nav-row li {
            display: flex;
            align-items: center;
        }

        .nav-row li a {
            color: #a1a1a1;
            text-decoration: none;
            font-size: 13.5px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: color 0.3s ease;
            padding: 8px 0;
        }

        .nav-row li a:hover {
            color: #fff;
        }

        .separator {
            color: #666;
            margin: 0 20px;
            font-weight: 300;
            font-size: 13px;
        }

        .search-icon {
            color: #b8b8b8;
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            transition: color 0.3s;
            margin-left: auto;
        }

        .search-icon:hover {
            color: #fff;
        }

        .mobile-toggle {
            display: none;
            background: none;
            border: none;
            color: #b8b8b8;
            font-size: 28px;
            cursor: pointer;
            padding: 8px;
            margin-left: auto;
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #d32f2f;
            font-size: 1.1em;
        }

        @media (max-width: 1024px) {
            .separator {
                margin: 0 15px;
            }

            .nav-row li a {
                font-size: 12px;
            }
        }

        @media (max-width: 768px) {
            .nav-container {
                padding: 15px 20px;
            }

            .mobile-toggle {
                display: block;
            }

            .nav-row {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.4s ease-in-out, padding 0.4s ease-in-out;
                flex-direction: column;
                align-items: flex-start;
                padding: 0;
                border: none;
            }

            .nav-row.active {
                max-height: 800px;
                padding: 15px 0;
            }

            .nav-row li {
                width: 100%;
                padding: 12px 0;
                border-bottom: 1px solid #3d3d3d;
            }

            .nav-row li:last-child {
                border-bottom: none;
            }

            .nav-row li a {
                font-size: 14px;
            }

            .separator {
                display: none;
            }

            .search-icon {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <!-- <div style="padding-right: 0px; padding-top: 0px; ; padding-bottom: 0px; margin-bottom: 0px;"> -->
        <div>
        <img src="./SoncniBlog-GitHub.png" style="height: 140px; width: auto;  margin-bottom: 0px; display: block;">
        </div>
        <nav class="nav-container">
            <button class="mobile-toggle" onclick="toggleMenu()" aria-label="Toggle menu">‚ò∞</button>
            
            <ul class="nav-row" id="navRow1">
                <li><a href="https://soncniblog.com/">NA ZAƒåETEK</a></li>
                <li><span class="separator">/</span></li>
                <li><a href="https://soncniblog.com/o-blogu/">O BLOGU</a></li>
                <li><span class="separator">/</span></li>
                <li><a href="https://soncniblog.com/zgodbe-iz-vesolja/">ZGODBE IZ VESOLJA</a></li>
                <li><span class="separator">/</span></li>
                <li><a href="https://soncniblog.com/novice-iz-vesolja/">NOVICE IZ VESOLJA</a></li>
                <li><span class="separator">/</span></li>
                <li><a href="https://soncniblog.com/osnove-vesoljskega-vremena/">ABC VESOLJSKEGA VREMENA</a></li>
                <li><span class="separator">/</span></li>
                <li><a href="https://soncniblog.com/kaj-je-kaj/">NEKATERI POJMI</a></li>
            </ul>

            <ul class="nav-row" id="navRow2">
                <li><a href="https://soncniblog.com/astronomski-koledar/">ASTRONOMSKI KOLEDAR</a></li>
                <li><span class="separator">/</span></li>
                <li><a href="https://primoz-igeof.github.io/SoncniBlog/"> TRENUTNO STANJE NA SONCU IN VESOLJSKO VREME</a></li>
                <li><span class="separator">/</span></li>
                <li><a href="https://soncniblog.com/zanimive-povezave/">ZANIMIVE POVEZAVE</a></li>
                <li><span class="separator">/</span></li>
                <li><a href="https://soncniblog.com/imate-vprasanje/">IMATE VPRA≈†ANJE?</a></li>
                <li><span class="search-icon">üîç</span></li>
            </ul>
        </nav>
    </div>
    <div class="dashboardZero">
        <h1 style="text-align: center;">Napoved vesoljskega vremena</h1><br><br><br>
        <div class="dashboardOne">
            <div class="card">
                <h2><center>Trenutne Sonƒçeve pege</center></h2>
                <a href="https://soho.nascom.nasa.gov/data/synoptic/sunspots_earth/mdi_sunspots_1024.jpg" target="_blank"> <img src="https://soho.nascom.nasa.gov/data/synoptic/sunspots_earth/mdi_sunspots_1024.jpg" alt="Sunspot image" class="center"></a>
                <p style="text-align: center;">Vir: SOHO/MDI.</p>
            </div>
            <div class="vertical-separator"></div>
        </div>
        <div class="dashboardThree">
            <div class="card">
                <a href="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_0193.jpg" target="_blank"> <img src="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_0193.jpg" alt="Sunspot image" class="center"></a>
                <p style="text-align: center;">Vir: SDO/AIA 193 √Ö.</p>
            </div>
            <div class="card">
                <a href="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_0304.jpg" target="_blank"> <img src="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_0304.jpg" alt="Sunspot image" class="center"></a>
                <p style="text-align: center;">Vir: SDO/AIA 304 √Ö.</p>
            </div>
            <div class="card">
                <a href="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_0171.jpg" target="_blank"> <img src="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_0171.jpg" alt="Sunspot image" class="center"></a>
                <p style="text-align: center;">Vir: SDO/AIA 171 √Ö.</p>
            </div>
            <div class="card">
                <a href="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_0211.jpg" target="_blank"> <img src="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_0211.jpg" alt="Sunspot image" class="center"></a>
                <p style="text-align: center;">Vir: SDO/AIA 211 √Ö.</p>
            </div>
            <div class="card">
                <a href="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_0131.jpg" target="_blank"> <img src="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_0131.jpg" alt="Sunspot image" class="center"></a>
                <p style="text-align: center;">Vir: SDO/AIA 131 √Ö.</p>
            </div>
            <div class="card">
                <a href="https://soho.nascom.nasa.gov/data/realtime/hmi_mag/1024/latest.jpg" target="_blank"> <img src="https://soho.nascom.nasa.gov/data/realtime/hmi_mag/1024/latest.jpg" alt="Sunspot image" class="center"></a>
                <p style="text-align: center;">Vir: SOHO/HMI.</p>
            </div>
            <div class="card">
                <a href="https://soho.nascom.nasa.gov/data/realtime/c2/1024/latest.jpg" target="_blank"> <img src="https://soho.nascom.nasa.gov/data/realtime/c2/1024/latest.jpg" alt="Sunspot image" class="center"></a>
                <p style="text-align: center;">Vir: SOHO/LASCO C2.</p>
            </div>
            <div class="card">
                <a href="https://soho.nascom.nasa.gov/data/realtime/c3/1024/latest.jpg" target="_blank"> <img src="https://soho.nascom.nasa.gov/data/realtime/c3/1024/latest.jpg" alt="Sunspot image" class="center"></a>
                <p style="text-align: center;">Vir: SOHO/LASCO C3.</p>
            </div>
        </div>
        <div class="dashboard">
        <!-- Aurora Forecast - Northern Hemisphere -->
            <div class="card">
                <h2>Napoved severnega polarnega sija</h2>
                <img src="https://services.swpc.noaa.gov/images/animations/ovation/north/latest.jpg" 
                    alt="Aurora Forecast Northern Hemisphere"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div class="loading" style="display:none;">Slika trenutno ni na voljo</div>
                <p>30-90 minutna napoved lokacije ter intenzivnosti polarnega sija na podlagi modela OVATION.</p>
                <p><a href="https://www.swpc.noaa.gov/products/aurora-30-minute-forecast" target="_blank">Celotna napoved ‚Üí</a></p>
            </div>

                <!-- Aurora Forecast - Southern Hemisphere -->
            <div class="card">
                <h2>Napoved ju≈ænega polarnega sija</h2>
                <img src="https://services.swpc.noaa.gov/images/animations/ovation/south/latest.jpg" 
                    alt="Aurora Forecast Southern Hemisphere"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div class="loading" style="display:none;">Slika trenutno ni na voljo</div>
                <p>30-90 minutna napoved lokacije ter intenzivnosti polarnega sija na podlagi modela OVATION.</p>
                <p><a href="https://www.swpc.noaa.gov/products/aurora-30-minute-forecast" target="_blank">Celotna napoved ‚Üí</a></p>
            </div>

        <!-- WSA-ENLIL Solar Wind Prediction -->
            <div class="card">
                <h2>Napoved Sonƒçevega vetra (WSA-ENLIL)</h2>
                <img src="https://services.swpc.noaa.gov/images/animations/enlil/latest.jpg" 
                    alt="WSA-ENLIL Solar Wind Prediction"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div class="loading" style="display:none;">Slika trenutno ni na voljo</div>
                <p>Napovedana struktura Sonƒçnevega vetra in koronarnih izbruhov snovi (CME) z 1-4 dnevnim predhodnim opozorilom.</p>
                <p><a href="https://www.swpc.noaa.gov/products/wsa-enlil-solar-wind-prediction" target="_blank">Celotna napoved ‚Üí</a></p>
            </div>
        <!-- GOES X-Ray Flux -->
            <div class="card">
                <h2>Jakost rentgenskega sevanja GOES (6 ur)</h2>
                <div class="controls">
                    <button id="btn6hour" class="active" onclick="setTimeRange('6hour')">6 ur</button>
                    <button id="btn1day" onclick="setTimeRange('1day')">1 dan</button>
                    <button id="btn3day" onclick="setTimeRange('3day')">3 dnevi</button>
                    <button id="btn7day" onclick="setTimeRange('7day')">7 dni</button>
                    <button id="refreshBtn" onclick="fetchData()">‚Üª Osve≈æi</button>
                </div>
                <canvas id="xrayChart"></canvas>
                <p class="status">Nalaganje podatkov rentgenskega sevanja...</p>
                <p>Jakost Sonƒçevih bli≈°ƒçev: 1-8 √Ö (rdeƒça barva) in 0.5-4 √Ö (modra). Logaritemska lestvica z razredi izbruhov: A, B, C, M, X.</p>
                <p><a href="https://www.swpc.noaa.gov/products/goes-x-ray-flux" target="_blank">Dostop do vseh podatkov ‚Üí</a></p>
            </div>
        <!-- Dst Index -->
            <div class="card">
                <h2>Indeks Dst v realnem ƒçasu</h2>
                <img id="dstImage" src="" alt="Indeks Dst Trenutni Mesec" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <!-- <div class="loading" style="display:none;">Slika trenutno ni na voljo</div> -->
                <p>Indeks Dst (Disturbance Storm Time) meri intenzivnost geomagnetnih neviht. Vrednosti pod -50 nT ka≈æejo na nevihtne razmere.</p>
                <p><a href="https://wdc.kugi.kyoto-u.ac.jp/dst_realtime/presentmonth/" target="_blank">Dostop do vseh podatkov ‚Üí</a></p>
            </div>

        <!-- Planetary K-Index -->
            <div class="card">
                <h2>Indeks Kp (3 dnevi)</h2>
                <canvas id="kIndexChart"></canvas>
                <p class="status">Nalaganje podatkov indeksa Kp...</p>
                <p>Indikator geomagnetne aktivnosti (lestvica 0-9). Barve nakazujejo na intenzivnost geomagnetnih perturbacij (zelena=mirno, rumena=nestabilno, rdeƒça=nevihta).</p>
                <p><a href="https://www.swpc.noaa.gov/products/planetary-k-index" target="_blank">Dostop do vseh podatkov ‚Üí</a></p>
            </div>
                <div class="vertical-separator"></div>
            </div>
        <div class="dashboardTwo">
        <!-- Solar cycle progression -->
            <div class="card">
                <h2>Sonƒçev cikel 25 - ≈°tevilo Sonƒçevih peg</h2>
                <canvas id="solarCycleChart"></canvas>
                <p class="status">Nalaganje podatkov o Sonƒçevem ciklu...</p>
                <p>≈†tevilo opa≈æenih peg (ƒçrna barva) ter povpreƒçja (vijoliƒçna) za Sonƒçev cikel 25. Posodobljeno meseƒçno z podatki SILSO.</p>
                <p><a href="https://www.swpc.noaa.gov/products/solar-cycle-progression" target="_blank">Dostop do vseh podatkov ‚Üí</a></p>
            </div>
        <div class="dashboardTwo">
        <!-- Solar cycle progression -->
                <!-- <p class="subtitle">Magnetno polje</p> -->
                <!-- <canvas id="solarWindBChart"></canvas> -->
            <div class="card">
                <!-- <canvas id="solarWindChart"></canvas> -->
                <h2>Sonƒçev veter v ≈æivo</h2>
                <div class="controls">
                     <button id="btn6hour" class="active" onclick="setTimeRange('6hour')">6 ur</button>

                    <button id="btn2uri" onclick="loadData('2-hour')" class="active">2 Uri</button>
                    <button id="btn6ur" onclick="loadData('6-hour')">6 Ur</button>
                    <button id="btn1dan" onclick="loadData('1-day')">1 Dan</button>
                    <button id="btn3dnevi" onclick="loadData('3-day')">3 Dnevi</button>
                    <button id="btn7dni" onclick="loadData('7-day')">7 Dni</button>
                </div>

                <div id="loading" class="loading">Loading solar wind data...</div>
                <div id="error" class="error" style="display: none;"></div>

               <div id="charts" style="display: none; width: 1150px;">
                    <div class="chart-container">
                        <div class="chart-title">Magnetno polje (nT)</div>
                        <canvas id="magChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-title">Hitrost (km/s)</div>
                        <canvas id="speedChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-title">Gostota protonov (delcev/cm¬≥)</div>
                        <canvas id="densityChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-title">Temperatura (K)</div>
                        <canvas id="tempChart"></canvas>
                    </div>
                </div>
        
                <div id="lastUpdate" class="last-updated"></div>
            </div>
        </div>
    </div>
    
    <div class="refresh-info">
        <div class="last-updated">
            <strong>Zadnja posodobitev:</strong> <span id="timestamp"></span>
        </div>
        <p style="margin-top: 15px;">Grafi se samodejno osve≈æujejo vsakih 5 minut</p>
        <p>Viri podatkov: NOAA Space Weather Prediction Center & World Data Center for Geomagnetism, Kyoto</p>
    </div>
    
     <script>
        //Get current year and month
        function getDstImageUrl() {

            const now = new Date();
            const year = now.getUTCFullYear().toString().slice(-2); // Last 2 digits of year (UTC)
            const month = (now.getUTCMonth() + 1).toString().padStart(2, '0'); // Month with leading zero (UTC)
            return `https://wdc.kugi.kyoto-u.ac.jp/dst_realtime/presentmonth/dst${year}${month}.png`;
        }

        document.getElementById('dstImage').src = getDstImageUrl();

        // Update the Dst image in the refresh interval
        setInterval(() => {
            document.getElementById('dstImage').src = getDstImageUrl() + '?t=' + new Date().getTime();
        }, 300000); // 5 minutes

        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('timestamp').textContent = now.toLocaleString();
        }
        
        updateTimestamp();
        
        // Chart instances
        let solarCycleChart, kIndexChart, xrayChart;
        // Load Solar Cycle Data (Cycle 25 only)
        async function loadSolarCycleData() {
            try {
                const response = await fetch('https://services.swpc.noaa.gov/json/solar-cycle/observed-solar-cycle-indices.json');
                const allData = await response.json();
                
                // Filter for Solar Cycle 25 (starts Dec 2019)

                const cycle25Start = new Date('2015-12-01');
                const recentData = allData.filter(d => {
                const date = new Date(d['time-tag'] + '-01');
                    return date >= cycle25Start //&& d.smoothed_ssn >= 0;
                });
                
                const labels = recentData.map(d => d['time-tag']);
                const ssnValues = recentData.map(d => d.ssn >= 0 ? d.ssn : null);
                const smoothedSSN = recentData.map(d => d.smoothed_ssn >= 0 ? d.smoothed_ssn : null);
                
                const ctx = document.getElementById('solarCycleChart').getContext('2d');
                
                if (solarCycleChart) solarCycleChart.destroy();
                
                solarCycleChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Meseƒçno ≈°tevilo Sonƒçevih peg',
                                data: ssnValues,
                                borderColor: 'rgba(0, 0, 0, 0.8)',
                                backgroundColor: 'rgba(0, 0, 0, 0)',
                                borderWidth: 1,
                                pointRadius: 0,
                                fill: false,
                                tension: 0
                            },
                            {
                                label: 'Povpreƒçno ≈°tevilo Sonƒçevih peg (smoothed)',
                                data: smoothedSSN,
                                borderColor: 'rgb(147, 51, 234)',
                                backgroundColor: 'rgba(147, 51, 234, 0.1)',
                                borderWidth: 3,
                                pointRadius: 0,
                                fill: false,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    title: function(context) {
                                        return 'Date: ' + context[0].label;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Leto'
                                },
                                ticks: {
                                    maxTicksLimit: 12
                                }
                            },
                            y: {
                                beginAtZero: true,
                                max: 250,
                                title: {
                                    display: true,
                                    text: '≈†tevilo Sonƒçevih peg'
                                }
                            }
                        }
                    }
                });
                
                document.querySelector('#solarCycleChart + .status').textContent = 'Data updated: ' + new Date().toLocaleTimeString();
            } catch (error) {
                console.error('Error loading solar cycle data:', error);
                document.querySelector('#solarCycleChart + .status').textContent = 'Error loading data. Retrying...';
            }
        }
        
        // Load K-Index Data
        async function loadKIndexData() {
            try {
                const response = await fetch('https://services.swpc.noaa.gov/products/noaa-planetary-k-index.json');
                const data = await response.json();
                
                // Skip header row and get last 3 days (24 readings)
                const recentData = data.slice(1).slice(-24);
                
                const labels = recentData.map(d => {
                    const date = new Date(d[0]);
                    const day = date.getDate();
                    const hour = date.getUTCHours().toString().padStart(2, '0');
                    return day + '/' + hour + 'Z';
                });
                const kpValues = recentData.map(d => parseFloat(d[1]));
                
                const ctx = document.getElementById('kIndexChart').getContext('2d');
                
                if (kIndexChart) kIndexChart.destroy();
                
                // Create gradient colors for storm levels matching NOAA style
                const backgroundColors = kpValues.map(v => {
                    if (v >= 9) return 'rgba(139, 0, 0, 0.9)'; // G5
                    if (v >= 8) return 'rgba(255, 0, 0, 0.9)'; // G4
                    if (v >= 7) return 'rgba(255, 69, 0, 0.9)'; // G3
                    if (v >= 6) return 'rgba(255, 140, 0, 0.9)'; // G2
                    if (v >= 5) return 'rgba(255, 215, 0, 0.9)'; // G1
                    if (v >= 4) return 'rgba(255, 255, 0, 0.9)'; // Unsettled
                    return 'rgba(0, 128, 0, 0.8)'; // Quiet
                });
                
                kIndexChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Kp Index',
                            data: kpValues,
                            backgroundColor: backgroundColors,
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = 'Kp: ' + context.parsed.y.toFixed(2);
                                        const v = context.parsed.y;
                                        if (v >= 9) label += ' (G5 - Extreme)';
                                        else if (v >= 8) label += ' (G4 - Severe)';
                                        else if (v >= 7) label += ' (G3 - Strong)';
                                        else if (v >= 6) label += ' (G2 - Moderate)';
                                        else if (v >= 5) label += ' (G1 - Minor Storm)';
                                        else if (v >= 4) label += ' (Unsettled)';
                                        else label += ' (Quiet)';
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Day/Hour (UTC)'
                                },
                                ticks: {
                                    maxTicksLimit: 24,
                                    autoSkip: false
                                }
                            },
                            y: {
                                beginAtZero: true,
                                max: 9,
                                title: {
                                    display: true,
                                    text: 'Planetary Kp Index'
                                },
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
                
                document.querySelector('#kIndexChart + .status').textContent = 'Data updated: ' + new Date().toLocaleTimeString();
            } catch (error) {
                console.error('Error loading K-index data:', error);
                document.querySelector('#kIndexChart + .status').textContent = 'Error loading data. Retrying...';
            }
        }
        
        let timeRange = '6hour';
        let updateInterval;

        const endpoints = {
            '6hour': 'https://services.swpc.noaa.gov/json/goes/primary/xrays-6-hour.json',
            '1day': 'https://services.swpc.noaa.gov/json/goes/primary/xrays-1-day.json',
            '3day': 'https://services.swpc.noaa.gov/json/goes/primary/xrays-3-day.json',
            '7day': 'https://services.swpc.noaa.gov/json/goes/primary/xrays-7-day.json'
        };

        function setTimeRange(range) {
            timeRange = range;
            document.getElementById('btn6hour').classList.toggle('active', range === '6hour');
            document.getElementById('btn1day').classList.toggle('active', range === '1day');
            document.getElementById('btn3day').classList.toggle('active', range === '3day');
            document.getElementById('btn7day').classList.toggle('active', range === '7day');
            loadXRayData();
        }

        // Load X-Ray Data (6-hour window)
        async function loadXRayData() {
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.disabled = true;
            refreshBtn.innerHTML = '<span class="spinning">‚Üª</span> Loading...';

            try {
                // const response = await fetch('https://services.swpc.noaa.gov/json/goes/primary/xrays-6-hour.json');
                const response = await fetch(endpoints[timeRange]);
                const allData = await response.json();
                
                // const shortWave = [];
                // const longWave = [];
                // const times = [];

                // Separate by energy band
                const data_1_8 = allData.filter(d => d.energy === "0.1-0.8nm");
                const data_0_5_4 = allData.filter(d => d.energy === "0.05-0.4nm");
                
                // Sample every 3rd point to reduce density
                const sampledData_1_8 = data_1_8.filter((_, i) => i % 3 === 0);
                const sampledData_0_5_4 = data_0_5_4.filter((_, i) => i % 3 === 0);
                
                const labels = sampledData_1_8.map(d => {
                    const date = new Date(d.time_tag);
                    return date.getUTCHours().toString().padStart(2, '0') + ':' + 
                           date.getUTCMinutes().toString().padStart(2, '0');
                });
                
                const flux1_8 = sampledData_1_8.map(d => d.flux > 0 ? d.flux : null);
                const flux0_5_4 = sampledData_0_5_4.map(d => d.flux > 0 ? d.flux : null);
                
                const ctx = document.getElementById('xrayChart').getContext('2d');
                
                if (xrayChart) xrayChart.destroy();
                
                xrayChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: '0.1-0.8 nm (1-8 √Ö)',
                                data: flux1_8,
                                borderColor: 'rgb(220, 38, 38)',
                                backgroundColor: 'rgba(220, 38, 38, 0.1)',
                                borderWidth: 2,
                                pointRadius: 0,
                                fill: false,
                                tension: 0
                            },
                            {
                                label: '0.05-0.4 nm (0.5-4 √Ö)',
                                data: flux0_5_4,
                                borderColor: 'rgb(37, 99, 235)',
                                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                borderWidth: 2,
                                pointRadius: 0,
                                fill: false,
                                tension: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Time (UTC)'
                                },
                                ticks: {
                                    maxTicksLimit: 12
                                }
                            },
                            y: {
                                type: 'logarithmic',
                                min: 1e-9,
                                max: 1e-2,
                                title: {
                                    display: true,
                                    text: 'Watts/m¬≤'
                                },
                                ticks: {
                                    callback: function(value) {
                                        const exp = Math.log10(value);
                                        if (exp === -9) return '10‚Åª‚Åπ (A1)';
                                        if (exp === -8) return '10‚Åª‚Å∏ (B1)';
                                        if (exp === -7) return '10‚Åª‚Å∑ (C1)';
                                        if (exp === -6) return '10‚Åª‚Å∂ (M1)';
                                        if (exp === -5) return '10‚Åª‚Åµ (M10)';
                                        if (exp === -4) return '10‚Åª‚Å¥ (X1)';
                                        if (exp === -3) return '10‚Åª¬≥ (X10)';
                                        return '';
                                    }
                                }
                            }
                        }
                    }
                });
                
                document.querySelector('#xrayChart + .status').textContent = 'Data updated: ' + new Date().toLocaleTimeString();
            } catch (error) {
                console.error('Error loading X-ray data:', error);
                document.querySelector('#xrayChart + .status').textContent = 'Error loading data. Retrying...';
            }
        }
        
        // Initial load
        loadSolarCycleData();
        loadKIndexData();
        loadXRayData();
        
        // Auto-refresh every 5 minutes
        setInterval(() => {
            const images = document.querySelectorAll('.card img');
            images.forEach(img => {
                const src = img.src.split('?')[0];
                img.src = src + '?t=' + new Date().getTime();
            });
            
            // Reload chart data
            loadSolarCycleData();
            loadKIndexData();
            loadXRayData();
            
            updateTimestamp();
        }, 300000); // 5 minutes

        let charts = {};
        let currentPeriod = '2-hour';

        async function loadData(period) {
            currentPeriod = period;
            
            // Update active button
            document.querySelectorAll('.controls button').forEach(btn => {
                btn.classList.remove('active');
            });
            if (event && event.target) {
                event.target.classList.add('active');
            } else {
                document.querySelector('.controls button').classList.add('active');
            }
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            document.getElementById('charts').style.display = 'none';
            
            try {
                const [magData, plasmaData] = await Promise.all([
                    fetch(`https://services.swpc.noaa.gov/products/solar-wind/mag-${period}.json`).then(r => r.json()),
                    fetch(`https://services.swpc.noaa.gov/products/solar-wind/plasma-${period}.json`).then(r => r.json())
                ]);
                
                displayCharts(magData, plasmaData);
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('charts').style.display = 'block';
                
                const now = new Date().toUTCString();
                document.getElementById('lastUpdate').textContent = `Zadnja posodobitev: ${now}`;
                
            } catch (error) {
                console.error('Error details:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = `Napaka pri nalaganju podatkov: ${error.message}. Prosimo, preverite svojo internetno povezavo in poskusite znova.`;
            }
        }

        function displayCharts(magData, plasmaData) {
            // Destroy existing charts
            Object.values(charts).forEach(chart => chart.destroy());
            charts = {};
            
            // Process magnetometer data (skip header row)
            const magTimeLabels = [];
            const btData = [];
            const bzData = [];
            const byData = [];
            const bxData = [];
            
            for (let i = 1; i < magData.length; i++) {
                const row = magData[i];
                const time = new Date(row[0]);
                magTimeLabels.push(time);
                btData.push(parseFloat(row[6]) || null);
                bzData.push(parseFloat(row[3]) || null);
                byData.push(parseFloat(row[2]) || null);
                bxData.push(parseFloat(row[1]) || null);
            }
            
            // Process plasma data (skip header row)
            const plasmaTimeLabels = [];
            const speedData = [];
            const densityData = [];
            const tempData = [];
            
            for (let i = 1; i < plasmaData.length; i++) {
                const row = plasmaData[i];
                const time = new Date(row[0]);
                plasmaTimeLabels.push(time);
                speedData.push(parseFloat(row[1]) || null);
                densityData.push(parseFloat(row[2]) || null);
                tempData.push(parseFloat(row[3]) || null);
            }
            
            // Create magnetometer chart
            const magCtx = document.getElementById('magChart').getContext('2d');
            charts.mag = new Chart(magCtx, {
                type: 'line',
                data: {
                    labels: magTimeLabels,
                    datasets: [
                        {
                            label: 'Bt (Total)',
                            data: btData,
                            borderColor: '#f44336',
                            backgroundColor: 'rgba(244, 67, 54, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            tension: 0.1
                        },
                        {
                            label: 'Bz',
                            data: bzData,
                            borderColor: '#2196f3',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            tension: 0.1
                        },
                        {
                            label: 'By',
                            data: byData,
                            borderColor: '#4caf50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            tension: 0.1
                        },
                        {
                            label: 'Bx',
                            data: bxData,
                            borderColor: '#ff9800',
                            backgroundColor: 'rgba(255, 152, 0, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            tension: 0.1
                        }
                    ]
                },
                options: getChartOptions('nT')
            });
            
            // Create speed chart
            const speedCtx = document.getElementById('speedChart').getContext('2d');
            charts.speed = new Chart(speedCtx, {
                type: 'line',
                data: {
                    labels: plasmaTimeLabels,
                    datasets: [{
                        label: 'Hitrost',
                        data: speedData,
                        borderColor: '#9c27b0',
                        backgroundColor: 'rgba(156, 39, 176, 0.1)',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: getChartOptions('km/s')
            });
            
            // Create density chart
            const densityCtx = document.getElementById('densityChart').getContext('2d');
            charts.density = new Chart(densityCtx, {
                type: 'line',
                data: {
                    labels: plasmaTimeLabels,
                    datasets: [{
                        label: 'Gostota',
                        data: densityData,
                        borderColor: '#009688',
                        backgroundColor: 'rgba(0, 150, 136, 0.1)',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: getChartOptions('p/cm¬≥')
            });
            
            // Create temperature chart
            const tempCtx = document.getElementById('tempChart').getContext('2d');
            charts.temp = new Chart(tempCtx, {
                type: 'line',
                data: {
                    labels: plasmaTimeLabels,
                    datasets: [{
                        label: 'Temperatura',
                        data: tempData,
                        borderColor: '#ff5722',
                        backgroundColor: 'rgba(255, 87, 34, 0.1)',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: getChartOptions('K')
            });
        }

        function getChartOptions(unit) {
            return {
                responsive: true,
                maintainAspectRatio: true,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                const date = new Date(context[0].parsed.x);
                                return date.toUTCString();
                            },
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += context.parsed.y.toFixed(2) + ' ' + unit;
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            displayFormats: {
                                hour: 'HH:mm',
                                day: 'MMM dd'
                            }
                        },
                        title: {
                            display: true,
                            text: 'Datum in ura (UTC)'
                        },
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: unit
                        },
                        beginAtZero: false
                    }
                }
            };
        }

        // Load initial data
        loadData('2-hour');
        
        // Auto-refresh every 5 minutes
        setInterval(() => {
            loadData(currentPeriod);
        }, 300000);
    </script>
</body>
</html>
